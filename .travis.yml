# sudo: required
language: bash
services: docker

env:
  global:
    - REGISTRY_USER=storagebofh
    - secure: "ktyaKL4M0c5Z4o7toAQOM+FnnjPHjTL29rAjsqZszX4pbkjD62FZgrYkuaXRFUobK+5IpW3LigxJCagynmLUqAIdWqflvEDb0trSsAvKqCjYAS7oS153yyct9tjpnoLrk2FFJYy1UN5+jzM0M4wTJYca5qpanmRvxcJWuGqS5eJ4YqWO7weYXuIU4SBgsmbbzE/nYAlD1lSApfDe1GoIaML6C3yWs5sESTrMfPcXEnXLU7IyJDFLMS6ct+tJJoBF9XzyTkD1Kg0zvOhd+AYibjqVPqX9zyxQIGBj88s0nMGEg/ez/jpex/ilw19ouFUNmIeNpPC4qZ626Yu47ZbAT48hPFx0HU/JLDAUc8nhfTBR4/F5Hy/vbyhU48hw6gshQFplMWQmsFHwokag1LGdIDgJ1p+9kRkK6PY5t8aCOgF264CjXzEOxgp3qlayBVMG+07/XC3Untle6j7Lox0UWUku6w0adajrRt9zP5NQS3uwuSjSRCaqHL5y9zGEM/LD/3JxHSpwZLqyhnv6SWv36RKxf6bahMfiOYQdJVR8Qr6BxZemyCFso4IEOQwEQJDqadRzbNqXD8iSZRoqIHqGJdMsJe5nX2ykWMwjSSQCHp1cItlPF3ymiLiFwOj24oEyG/Czinxw6ab+tZ/mE8fXcCbgeasArqfl/oKDc/r9nnw="
  matrix:
    - COMPILER=gcc VERSION=4.8
    # - COMPILER=gcc VERSION=4.9
    # - COMPILER=gcc VERSION=5.4
    # - COMPILER=gcc VERSION=6.5
    # - COMPILER=gcc VERSION=7.4
    # - COMPILER=gcc VERSION=8.1
    # - COMPILER=gcc VERSION=9.1
    # - COMPILER=gcc VERSION=latest
    # - COMPILER=clang VERSION=3.6
    # - COMPILER=clang VERSION=3.7
    # - COMPILER=clang VERSION=3.8
    # - COMPILER=clang VERSION=3.9
    # - COMPILER=clang VERSION=4.0
    # - COMPILER=clang VERSION=5.0
    # - COMPILER=clang VERSION=6.0
    # - COMPILER=clang VERSION=7.1
    # - COMPILER=clang VERSION=8.0
    # - COMPILER=clang VERSION=9.0
    # - COMPILER=clang VERSION=latest

before_script:
  - env | sort
  - cd "$COMPILER"/"$VERSION"
  - image="$COMPILER:$VERSION"

script:
  - |
    (
      set -Eeuo pipefail
      set -x
      docker build -t "$image" .
      docker run -ti --rm "$image" "$COMPILER" --version
    )

after_script:
  - docker images

before_deploy:
  - docker login -u "$REGISTRY_USER" -p "$REGISTRY_PASS"

deploy:
  provider: script
  script: 
    - docker images

